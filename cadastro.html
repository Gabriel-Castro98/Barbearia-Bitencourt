<!DOCTYPE html>
<html lang="pt-BR" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cadastro - Barbearia Bitencourt</title>
    <link href="dist/output.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body class="bg-zinc-950 text-zinc-50 font-['Poppins']">
    <div class="min-h-screen flex items-center justify-center px-4 py-12">
        <div class="max-w-md w-full">
            <div class="text-center mb-8">
                <a href="index.html" class="inline-flex items-center gap-2 mb-6">
                    <svg class="w-10 h-10 text-amber-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.121 14.121L19 19m-7-7l7-7m-7 7l-2.879 2.879M12 12L9.121 9.121m0 5.758a3 3 0 10-4.243 4.243 3 3 0 004.243-4.243zm0-5.758a3 3 0 10-4.243-4.243 3 3 0 004.243 4.243z"></path>
                    </svg>
                </a>
                <h1 class="text-3xl font-bold mb-2">Criar Conta</h1>
                <p class="text-zinc-400">Cadastre-se para agendar seus horários</p>
            </div>

            <div class="bg-zinc-900 rounded-2xl p-8 border border-zinc-800">
                <!-- Adicionado mensagem de erro -->
                <div id="error-message" class="hidden bg-red-500/10 border border-red-500 text-red-500 px-4 py-3 rounded-lg mb-6">
                    <p class="text-sm"></p>
                </div>

                <form id="signup-form" class="space-y-6">
                    <div>
                        <label class="block text-sm font-medium mb-2">Nome Completo</label>
                        <input type="text" id="name" name="name" required placeholder="João Silva" class="w-full bg-zinc-800 border border-zinc-700 rounded-lg px-4 py-3 focus:border-amber-500 focus:outline-none">
                    </div>

                    <div>
                        <label class="block text-sm font-medium mb-2">E-mail</label>
                        <input type="email" id="email" name="email" required placeholder="seu@email.com" class="w-full bg-zinc-800 border border-zinc-700 rounded-lg px-4 py-3 focus:border-amber-500 focus:outline-none">
                    </div>

                    <div>
                        <label class="block text-sm font-medium mb-2">Telefone</label>
                        <input type="tel" id="phone" name="phone" required placeholder="(11) 98765-4321" class="w-full bg-zinc-800 border border-zinc-700 rounded-lg px-4 py-3 focus:border-amber-500 focus:outline-none">
                    </div>

                    <div>
                        <label class="block text-sm font-medium mb-2">Senha</label>
                        <input type="password" id="password" name="password" required placeholder="••••••••" minlength="6" class="w-full bg-zinc-800 border border-zinc-700 rounded-lg px-4 py-3 focus:border-amber-500 focus:outline-none">
                    </div>

                    <div>
                        <label class="block text-sm font-medium mb-2">Confirmar Senha</label>
                        <input type="password" id="confirm-password" name="confirm-password" required placeholder="••••••••" class="w-full bg-zinc-800 border border-zinc-700 rounded-lg px-4 py-3 focus:border-amber-500 focus:outline-none">
                    </div>

                    <!-- Adicionado loading state -->
                    <button type="submit" id="signup-btn" class="w-full bg-amber-500 text-zinc-950 py-3 rounded-lg font-semibold hover:bg-amber-400 transition-colors">
                        Criar Conta
                    </button>
                </form>

                <div class="mt-6 text-center">
                    <p class="text-zinc-400">Já tem uma conta? <a href="login.html" class="text-amber-500 hover:text-amber-400 font-semibold">Entrar</a></p>
                </div>
            </div>
        </div>
    </div>
     <!-- Footer -->
    <footer class="bg-zinc-900 py-12 px-4 mt-20">
        <div class="container mx-auto text-center text-zinc-400">
            <p>&copy; 2025 Barbearia Bitencourt. Todos os direitos reservados.</p>
            <p>Desenvolvido por Gabriel Castro</p>
        </div>
    </footer>

    <!-- Integração com Firebase -->
    <script type="module">
        import { auth, db } from './firebase-config.js';
        import { createUserWithEmailAndPassword, updateProfile } from 'https://www.gstatic.com/firebasejs/12.5.0/firebase-auth.js';
        import { doc, setDoc, serverTimestamp } from 'https://www.gstatic.com/firebasejs/12.5.0/firebase-firestore.js';

        const signupForm = document.getElementById('signup-form');
        const signupBtn = document.getElementById('signup-btn');
        const errorMessage = document.getElementById('error-message');

        signupForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const name = document.getElementById('name').value;
            const email = document.getElementById('email').value;
            const phone = document.getElementById('phone').value;
            const password = document.getElementById('password').value;
            const confirmPassword = document.getElementById('confirm-password').value;

            // Validar senhas
            if (password !== confirmPassword) {
                errorMessage.querySelector('p').textContent = 'As senhas não coincidem.';
                errorMessage.classList.remove('hidden');
                return;
            }

            // Mostrar loading
            signupBtn.textContent = 'Criando conta...';
            signupBtn.disabled = true;
            errorMessage.classList.add('hidden');

            try {
                // Criar usuário no Firebase Auth
                const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                const user = userCredential.user;

                // Atualizar perfil com nome
                await updateProfile(user, {
                    displayName: name
                });

                // Salvar dados do usuário no Firestore
                await setDoc(doc(db, 'usuarios', user.uid), {
                    nome: name,
                    email: email,
                    telefone: phone,
                    criadoEm: serverTimestamp()
                });

                console.log('[v0] Usuário cadastrado com sucesso:', user.email);

                // Redirecionar para página de agendamento
                window.location.href = 'agendamento.html';
            } catch (error) {
                console.error('[v0] Erro no cadastro:', error);
                
                let mensagem = 'Erro ao criar conta. Tente novamente.';
                if (error.code === 'auth/email-already-in-use') {
                    mensagem = 'Este e-mail já está cadastrado.';
                } else if (error.code === 'auth/invalid-email') {
                    mensagem = 'E-mail inválido.';
                } else if (error.code === 'auth/weak-password') {
                    mensagem = 'A senha deve ter pelo menos 6 caracteres.';
                }

                errorMessage.querySelector('p').textContent = mensagem;
                errorMessage.classList.remove('hidden');
                
                signupBtn.textContent = 'Criar Conta';
                signupBtn.disabled = false;
            }
        });
    </script>
</body>
</html>

