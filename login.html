<!DOCTYPE html>
<html lang="pt-BR" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login - Barbearia Bitencourt</title>
    <link href="dist/output.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body class="bg-zinc-950 text-zinc-50 font-['Poppins']">
    <div class="min-h-screen flex items-center justify-center px-4 py-12">
        <div class="max-w-md w-full">
            <div class="text-center mb-8">
                <a href="index.html" class="inline-flex items-center gap-2 mb-6">
                    <svg class="w-10 h-10 text-amber-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                              d="M14.121 14.121L19 19m-7-7l7-7m-7 7l-2.879 2.879M12 12L9.121 9.121m0 5.758a3 3 0 10-4.243 4.243 
                              3 3 0 004.243-4.243zm0-5.758a3 3 0 10-4.243-4.243 3 3 0 004.243 4.243z"/>
                    </svg>
                </a>
                <h1 class="text-3xl font-bold mb-2">Bem-vindo de volta</h1>
                <p class="text-zinc-400">Entre com sua conta para continuar</p>
            </div>

            <div class="bg-zinc-900 rounded-2xl p-8 border border-zinc-800">
                <!-- Mensagem de erro -->
                <div id="error-message" class="hidden bg-red-500/10 border border-red-500 text-red-500 px-4 py-3 rounded-lg mb-6">
                    <p class="text-sm"></p>
                </div>

                <form id="login-form" class="space-y-6">
                    <div>
                        <label class="block text-sm font-medium mb-2">E-mail</label>
                        <input type="email" id="email" name="email" required placeholder="seu@email.com"
                               class="w-full bg-zinc-800 border border-zinc-700 rounded-lg px-4 py-3 focus:border-amber-500 focus:outline-none">
                    </div>

                    <div>
                        <label class="block text-sm font-medium mb-2">Senha</label>
                        <input type="password" id="password" name="password" required placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
                               class="w-full bg-zinc-800 border border-zinc-700 rounded-lg px-4 py-3 focus:border-amber-500 focus:outline-none">
                    </div>

                    <div class="flex items-center justify-between">
                        <label class="flex items-center gap-2 cursor-pointer">
                            <input type="checkbox" class="w-4 h-4 rounded border-zinc-700 bg-zinc-800 text-amber-500 focus:ring-amber-500">
                            <span class="text-sm text-zinc-400">Lembrar de mim</span>
                        </label>
                        <a href="#" class="text-sm text-amber-500 hover:text-amber-400">Esqueceu a senha?</a>
                    </div>

                    <button type="submit" id="login-btn"
                            class="w-full bg-amber-500 text-zinc-950 py-3 rounded-lg font-semibold hover:bg-amber-400 transition-colors">
                        Entrar
                    </button>
                </form>

                <div class="mt-6 text-center">
                    <p class="text-zinc-400">
                        N√£o tem uma conta? 
                        <a href="cadastro.html" class="text-amber-500 hover:text-amber-400 font-semibold">Cadastre-se</a>
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Firebase + Login Script -->
<script type="module">
    import { auth, db } from './firebase-config.js';
    import { signInWithEmailAndPassword } from 'https://www.gstatic.com/firebasejs/12.5.0/firebase-auth.js';
    import { doc, getDoc } from 'https://www.gstatic.com/firebasejs/12.5.0/firebase-firestore.js';

    const loginForm = document.getElementById('login-form');
    const loginBtn = document.getElementById('login-btn');
    const errorMessage = document.getElementById('error-message');

    loginForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        
        const email = document.getElementById('email').value.trim();
        const password = document.getElementById('password').value;

        // Mostrar "Entrando..."
        loginBtn.textContent = 'Entrando...';
        loginBtn.disabled = true;
        errorMessage.classList.add('hidden');

        try {
            const userCredential = await signInWithEmailAndPassword(auth, email, password);
            const user = userCredential.user;

            console.log('[LOGIN] Usu√°rio autenticado:', user.email);

            // Salva o e-mail do usu√°rio logado para uso em outras p√°ginas
            sessionStorage.setItem('userEmail', email);

            // üîç Busca o papel (role) do usu√°rio no Firestore
            const userDocRef = doc(db, 'usuarios', user.uid);
            const userDocSnap = await getDoc(userDocRef);

            if (userDocSnap.exists()) {
                const userData = userDocSnap.data();
                console.log('[LOGIN] Dados do usu√°rio:', userData);

                // Redireciona com base no papel do usu√°rio
                if (userData.role === 'admin') {
                    window.location.href = 'admin.html';
                } else {
                    window.location.href = 'agendamento.html';
                }
            } else {
                console.warn('[LOGIN] Documento do usu√°rio n√£o encontrado.');
                window.location.href = 'agendamento.html';
            }

        } catch (error) {
            console.error('[LOGIN] Erro:', error);

            let mensagem = 'Erro ao fazer login. Tente novamente.';
            if (error.code === 'auth/user-not-found') mensagem = 'Usu√°rio n√£o encontrado.';
            else if (error.code === 'auth/wrong-password') mensagem = 'Senha incorreta.';
            else if (error.code === 'auth/invalid-email') mensagem = 'E-mail inv√°lido.';

            errorMessage.querySelector('p').textContent = mensagem;
            errorMessage.classList.remove('hidden');
            
            loginBtn.textContent = 'Entrar';
            loginBtn.disabled = false;
        }
    });
</script>
</body>
</html>

