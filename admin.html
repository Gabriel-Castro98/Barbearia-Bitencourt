<!DOCTYPE html>
<html lang="pt-BR" class="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Painel Admin - Barbearia Bitencourt</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="style.css" />
  <style>
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(-10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .animate-fadeIn {
      animation: fadeIn 0.3s ease forwards;
    }
  </style>
</head>

<body class="bg-zinc-950 text-zinc-50 font-['Poppins']">
  <div class="min-h-screen flex flex-col">

    <!-- NAVBAR / HEADER -->
    <header class="bg-zinc-900 border-b border-zinc-800 px-6 py-4 relative">
      <div class="flex items-center justify-between">
        <h1 class="text-2xl font-bold">
          Painel <span class="text-amber-500">Administrativo</span>
        </h1>

        <!-- Menu Desktop -->
        <nav class="hidden md:flex items-center gap-6">
          <a href="#agendamentos" class="text-zinc-300 hover:text-amber-500 transition">Agendamentos</a>
          <a href="#estatisticas" class="text-zinc-300 hover:text-amber-500 transition">Estat√≠sticas</a>
          <a href="index.html" class="text-zinc-300 hover:text-amber-500 transition">√Årea do Cliente</a>
          <button id="logout-btn" class="text-red-400 hover:text-red-300 transition-colors">Sair</button>
        </nav>

        <!-- Bot√£o hamb√∫rguer -->
        <button id="menu-btn" class="md:hidden flex flex-col justify-between w-6 h-5">
          <span class="w-full h-0.5 bg-zinc-300 rounded"></span>
          <span class="w-full h-0.5 bg-zinc-300 rounded"></span>
          <span class="w-full h-0.5 bg-zinc-300 rounded"></span>
        </button>
      </div>

      <!-- Menu Mobile -->
      <nav id="mobile-menu" class="hidden flex-col bg-zinc-900 border-t border-zinc-800 mt-4 p-4 space-y-3 md:hidden rounded-xl">
        <a href="#agendamentos" class="block text-zinc-300 hover:text-amber-500 transition">Agendamentos</a>
        <a href="#estatisticas" class="block text-zinc-300 hover:text-amber-500 transition">Estat√≠sticas</a>
        <a href="index.html" class="block text-zinc-300 hover:text-amber-500 transition">√Årea do Cliente</a>
        <button id="logout-btn-mobile" class="w-full text-left text-red-400 hover:text-red-300 transition-colors">Sair</button>
      </nav>
    </header>

    <!-- CONTE√öDO PRINCIPAL -->
    <main class="flex-1 p-6 space-y-6">
      <!-- Stats -->
      <div id="estatisticas" class="grid md:grid-cols-4 gap-6">
        <div class="bg-zinc-900 rounded-xl p-6 border border-zinc-800">
          <h3 class="text-zinc-400 text-sm mb-2">Hoje</h3>
          <p id="stat-today" class="text-3xl font-bold">0</p>
          <p class="text-zinc-500 text-sm mt-1">agendamentos</p>
        </div>
        <div class="bg-zinc-900 rounded-xl p-6 border border-zinc-800">
          <h3 class="text-zinc-400 text-sm mb-2">Pendentes</h3>
          <p id="stat-pending" class="text-3xl font-bold">0</p>
          <p class="text-zinc-500 text-sm mt-1">aguardando confirma√ß√£o</p>
        </div>
        <div class="bg-zinc-900 rounded-xl p-6 border border-zinc-800">
          <h3 class="text-zinc-400 text-sm mb-2">Confirmados</h3>
          <p id="stat-confirmed" class="text-3xl font-bold">0</p>
          <p class="text-zinc-500 text-sm mt-1">confirmados</p>
        </div>
        <div class="bg-zinc-900 rounded-xl p-6 border border-zinc-800">
          <h3 class="text-zinc-400 text-sm mb-2">Total</h3>
          <p id="stat-total" class="text-3xl font-bold">0</p>
          <p class="text-zinc-500 text-sm mt-1">agendamentos</p>
        </div>
      </div>

      <!-- Filtros -->
      <div class="bg-zinc-900 rounded-xl p-6 border border-zinc-800">
        <div class="flex flex-wrap gap-4">
          <button onclick="filterBookings('all', event)" class="filter-btn active px-4 py-2 rounded-lg font-medium transition-colors bg-amber-500 text-zinc-950">Todos</button>
          <button onclick="filterBookings('pendente', event)" class="filter-btn px-4 py-2 rounded-lg font-medium transition-colors bg-zinc-800 text-zinc-300 hover:bg-zinc-700">Pendentes</button>
          <button onclick="filterBookings('confirmado', event)" class="filter-btn px-4 py-2 rounded-lg font-medium transition-colors bg-zinc-800 text-zinc-300 hover:bg-zinc-700">Confirmados</button>
          <button onclick="filterBookings('concluido', event)" class="filter-btn px-4 py-2 rounded-lg font-medium transition-colors bg-zinc-800 text-zinc-300 hover:bg-zinc-700">Conclu√≠dos</button>
          <input type="text" id="search-input" placeholder="Buscar por nome, data ou servi√ßo..." class="flex-1 min-w-[250px] bg-zinc-800 border border-zinc-700 rounded-lg px-4 py-2 focus:border-amber-500 focus:outline-none">
        </div>
      </div>

      <!-- Tabela -->
      <section id="agendamentos" class="bg-zinc-900 rounded-xl border border-zinc-800 overflow-hidden">
        <div class="p-6 border-b border-zinc-800">
          <h2 class="text-xl font-bold">Agendamentos em Tempo Real</h2>
        </div>
        <div class="overflow-x-auto">
          <table class="w-full">
            <thead class="bg-zinc-800/50">
              <tr>
                <th class="px-6 py-4 text-left text-sm font-semibold">Cliente</th>
                <th class="px-6 py-4 text-left text-sm font-semibold">Servi√ßo</th>
                <th class="px-6 py-4 text-left text-sm font-semibold">Barbeiro</th>
                <th class="px-6 py-4 text-left text-sm font-semibold">Data/Hora</th>
                <th class="px-6 py-4 text-left text-sm font-semibold">Telefone</th>
                <th class="px-6 py-4 text-left text-sm font-semibold">Status</th>
                <th class="px-6 py-4 text-left text-sm font-semibold">A√ß√µes</th>
              </tr>
            </thead>
            <tbody id="bookings-table" class="divide-y divide-zinc-800">
              <tr><td colspan="7" class="px-6 py-8 text-center text-zinc-500">Carregando agendamentos...</td></tr>
            </tbody>
          </table>
        </div>
      </section>
    </main>

     <!-- Footer -->
    <footer class="bg-zinc-900 py-12 px-4 mt-20">
        <div class="container mx-auto text-center text-zinc-400">
            <p>&copy; 2025 Barbearia Bitencourt. Todos os direitos reservados.</p>
            <p>Desenvolvido por Gabriel Castro</p>
        </div>
    </footer>

  <!-- SCRIPT -->
  <script type="module">
    import { auth, db } from "./firebase-config.js";
    import { onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-auth.js";
    import { collection, query, onSnapshot, doc, updateDoc, deleteDoc, orderBy } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-firestore.js";

    const ADMIN_EMAIL = "ytbgugu979@gmail.com";
    let allBookings = [];
    let currentFilter = "all";

    // üîí Prote√ß√£o silenciosa de acesso
    onAuthStateChanged(auth, (user) => {
      if (!user) {
        window.location.href = "login.html";
      } else if (user.email !== ADMIN_EMAIL) {
        window.location.href = "index.html";
      } else {
        loadBookings();
      }
    });

    // üìä Carregar agendamentos
    function loadBookings() {
      const q = query(collection(db, "agendamentos"), orderBy("criadoEm", "desc"));
      onSnapshot(q, (snapshot) => {
        allBookings = snapshot.docs.map((doc) => ({ id: doc.id, ...doc.data() }));
        updateStats();
        renderBookings();
      });
    }

    function updateStats() {
      const today = new Date().toISOString().split("T")[0];
      document.getElementById("stat-today").textContent = allBookings.filter((b) => b.data === today).length;
      document.getElementById("stat-pending").textContent = allBookings.filter((b) => b.status === "pendente").length;
      document.getElementById("stat-confirmed").textContent = allBookings.filter((b) => b.status === "confirmado").length;
      document.getElementById("stat-total").textContent = allBookings.length;
    }

    function renderBookings() {
      const tbody = document.getElementById("bookings-table");
      const searchTerm = document.getElementById("search-input").value.toLowerCase();
      let filtered = allBookings;

      if (currentFilter !== "all") filtered = filtered.filter((b) => b.status === currentFilter);
      if (searchTerm)
        filtered = filtered.filter(
          (b) =>
            b.nome.toLowerCase().includes(searchTerm) ||
            b.servico.toLowerCase().includes(searchTerm) ||
            b.data.includes(searchTerm)
        );

      if (filtered.length === 0) {
        tbody.innerHTML = `<tr><td colspan="7" class="px-6 py-8 text-center text-zinc-500">Nenhum agendamento encontrado.</td></tr>`;
        return;
      }

      const statusColors = {
        pendente: "bg-yellow-500/10 text-yellow-500 border-yellow-500",
        confirmado: "bg-green-500/10 text-green-500 border-green-500",
        concluido: "bg-blue-500/10 text-blue-500 border-blue-500",
        cancelado: "bg-red-500/10 text-red-500 border-red-500",
      };

      tbody.innerHTML = filtered
        .map(
          (b) => `
        <tr class="hover:bg-zinc-800/50 transition">
          <td class="px-6 py-4"><div class="font-medium">${b.nome}</div><div class="text-sm text-zinc-500">${b.email}</div></td>
          <td class="px-6 py-4">${b.servico}</td>
          <td class="px-6 py-4">${b.barbeiro}</td>
          <td class="px-6 py-4"><div>${new Date(b.data).toLocaleDateString("pt-BR")}</div><div class="text-sm text-zinc-500">${b.hora}</div></td>
          <td class="px-6 py-4">${b.telefone || "-"}</td>
          <td class="px-6 py-4"><span class="px-3 py-1 rounded-full text-xs font-medium border ${statusColors[b.status]}">${b.status.charAt(0).toUpperCase() + b.status.slice(1)}</span></td>
          <td class="px-6 py-4">
            <div class="flex gap-2">
              ${b.status === "pendente" ? `<button onclick="updateStatus('${b.id}','confirmado')" class="px-3 py-1 bg-green-500 text-white rounded hover:bg-green-600 text-sm">Confirmar</button>` : ""}
              ${b.status === "confirmado" ? `<button onclick="updateStatus('${b.id}','concluido')" class="px-3 py-1 bg-blue-500 text-white rounded hover:bg-blue-600 text-sm">Concluir</button>` : ""}
              <button onclick="deleteBooking('${b.id}')" class="px-3 py-1 bg-red-500 text-white rounded hover:bg-red-600 text-sm">Excluir</button>
            </div>
          </td>
        </tr>`
        )
        .join("");
    }

    window.updateStatus = async function (id, status) {
      await updateDoc(doc(db, "agendamentos", id), { status });
    };

    window.deleteBooking = async function (id) {
      if (!confirm("Tem certeza que deseja excluir este agendamento?")) return;
      await deleteDoc(doc(db, "agendamentos", id));
    };

    window.filterBookings = function (filter, event) {
      currentFilter = filter;
      document.querySelectorAll(".filter-btn").forEach((btn) => {
        btn.classList.remove("bg-amber-500", "text-zinc-950");
        btn.classList.add("bg-zinc-800", "text-zinc-300");
      });
      if (event) {
        event.target.classList.remove("bg-zinc-800", "text-zinc-300");
        event.target.classList.add("bg-amber-500", "text-zinc-950");
      }
      renderBookings();
    };

    document.getElementById("search-input").addEventListener("input", renderBookings);

    // üçî Menu hamb√∫rguer com anima√ß√£o
    const menuBtn = document.getElementById("menu-btn");
    const mobileMenu = document.getElementById("mobile-menu");
    const logoutBtnMobile = document.getElementById("logout-btn-mobile");

    menuBtn.addEventListener("click", () => {
      mobileMenu.classList.toggle("hidden");
      if (!mobileMenu.classList.contains("hidden")) {
        mobileMenu.classList.add("animate-fadeIn");
      }
    });

    logoutBtnMobile.addEventListener("click", async () => {
      await signOut(auth);
      window.location.href = "login.html";
    });
  </script>
</body>
</html>

